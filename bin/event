#!/usr/bin/env -S deno run --allow-env=PLUGIN_URL,DENO_DIR,HOME --allow-write --allow-read --unstable --allow-ffi

import {DB} from 'https://deno.land/x/sqlite@v3.7.0/mod.ts'
import {parseArgs} from 'https://deno.land/std/cli/parse_args.ts'
import {resolve} from 'https://deno.land/std@0.184.0/path/mod.ts'

const DB_PATH = resolve(
  new URL('.', import.meta.url).pathname,
  '..',
  'data',
  'personal.db',
)

const {name, value} = parseArgs(Deno.args, {
  string: ['name', 'value'],
})

if (!name) {
  throw new Error('Missing --name')
}

const db = new DB(DB_PATH)

try {
  db.query(`INSERT INTO events (name, value) VALUES (?, ?) RETURNING *`, [
    name,
    value,
  ])
} finally {
  db.close()
}
